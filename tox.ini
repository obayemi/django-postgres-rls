[tox]
envlist =
    py{311,313}-django{42,52}-pg{15,17}

skip_missing_interpreters = true
isolated_build = true

# Optional: Use uv for faster environment creation
# Uncomment to use uv (requires: pip install tox-uv)
# [testenv]
# runner = uv-venv-runner

[testenv]
deps =
    django42: Django>=4.2,<4.3
    django52: Django>=5.2,<5.3
    pytest>=7.0
    pytest-django>=4.0
    psycopg2-binary>=2.9
    testcontainers[postgres]>=4.0.0

setenv =
    PYTHONPATH = {toxinidir}
    DJANGO_SETTINGS_MODULE = django_postgres_rls.tests.test_settings
    # Tell tests to use testcontainers or skip PostgreSQL-dependent tests
    USE_EXISTING_POSTGRES = 0
    # PostgreSQL version configuration (defaults to 16 if not specified)
    pg15: POSTGRES_VERSION=15
    pg17: POSTGRES_VERSION=17

commands =
    pytest {posargs} -v

[testenv:coverage]
deps =
    Django>=5.2,<5.3
    pytest>=7.0
    pytest-django>=4.0
    pytest-cov>=4.0
    psycopg2-binary>=2.9

commands =
    pytest --cov=django_postgres_rls --cov-report=html --cov-report=term-missing {posargs:django_postgres_rls/tests/}
