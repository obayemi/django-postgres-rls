[tox]
envlist =
    # Django 3.x series (LTS) - Python 3.9+ only
    py{39,310,311,312,313,314}-django32
    # Django 4.x series - Python 3.9+ only
    py{39,310,311,312,313,314}-django40
    py{39,310,311,312,313,314}-django41
    py{39,310,311,312,313,314}-django42
    # Django 5.x series (requires Python 3.10+)
    py{310,311,312,313,314}-django50
    py{310,311,312,313,314}-django51
    py{310,311,312,313,314}-django52

skip_missing_interpreters = true
isolated_build = true

# Optional: Use uv for faster environment creation
# Uncomment to use uv (requires: pip install tox-uv)
# [testenv]
# runner = uv-venv-runner

[testenv]
deps =
    django32: Django>=3.2,<3.3
    django40: Django>=4.0,<4.1
    django41: Django>=4.1,<4.2
    django42: Django>=4.2,<4.3
    django50: Django>=5.0,<5.1
    django51: Django>=5.1,<5.2
    django52: Django>=5.2,<5.3
    pytest>=7.0
    pytest-django>=4.0
    psycopg2-binary>=2.9

setenv =
    PYTHONPATH = {toxinidir}
    DJANGO_SETTINGS_MODULE = django_postgres_rls.tests.test_settings

commands =
    # Run each test file separately to avoid model name conflicts
    pytest django_postgres_rls/tests/test_models.py {posargs} -v
    pytest django_postgres_rls/tests/test_management.py {posargs} -v
    pytest django_postgres_rls/tests/test_signals.py {posargs} -v
    pytest django_postgres_rls/tests/test_middleware.py {posargs} -v
    pytest django_postgres_rls/tests/test_role_permissions.py {posargs} -v

[testenv:coverage]
deps =
    Django>=5.2,<5.3
    pytest>=7.0
    pytest-django>=4.0
    pytest-cov>=4.0
    psycopg2-binary>=2.9

commands =
    pytest --cov=django_postgres_rls --cov-report=html --cov-report=term-missing {posargs:django_postgres_rls/tests/}
